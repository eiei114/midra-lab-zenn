---
title: "ã€å®Œå…¨åˆå¿ƒè€…ã«ã‚ˆã‚‹ã€‘Goè¨€èªã§APIã‚’åˆ©ç”¨ã—ã¦ãƒ©ãƒ³ãƒ€ãƒ ã«æŠ½å‡ºã—ãŸè‹±èªã®åè¨€ã‚’DeepLã«æµã—ã¦ç¿»è¨³ã™ã‚‹æ©Ÿèƒ½ã‚’ä½œã£ã¦ã¿ãŸ"
emoji: "ğŸ˜½"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [go, api, åˆå¿ƒè€…, deepl]
published: true
publication_name: midra_lab
---

## ã¯ã˜ã‚ã«
ç­†è€…ã¯å®Œå…¨åˆå¿ƒè€…ã®Goè¨€èªã®å­¦ç¿’è€…ã§ã™ã€‚æ™®æ®µã¯C#ã‚’ä½¿ã£ã¦é–‹ç™ºã‚’ã—ã¦ã„ã¾ã™ã€‚
æƒ…å ±å­¦ã«é–¢ã—ã¦æ·±ã„çŸ¥è¦‹ã‚’æŒã£ã¦ã„ã‚‹ã‚ã‘ã§ã‚ƒãªã„ã®ã§ã€é–“é•ã£ã¦ã„ã‚‹ã¨ã“ã‚ãŒã‚ã‚Œã°ã”æŒ‡æ‘˜ã„ãŸã ã‘ã‚‹ã¨å¹¸ã„ã§ã™ã€‚
ä»Šå›ã¯main.goã«ã¹ãŸæ›¸ãã—ã¦ã„ã‚‹ã®ã§è¦‹è‹¦ã—ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã”äº†æ‰¿ãã ã•ã„ã¾ã›ã€‚
## ä»Šå›ä½œæˆã—ãŸã‚‚ã®
ä»Šå›ã¯ã€[API Ninja](https://api-ninjas.com/)ã‚’åˆ©ç”¨ã—ã¦ãƒ©ãƒ³ãƒ€ãƒ ã«åè¨€ã‚’å–å¾—ã—ã€[DeepL](https://www.deepl.com/translator)ã‚’åˆ©ç”¨ã—ã¦ç¿»è¨³ã™ã‚‹æ©Ÿèƒ½ã‚’ä½œæˆã—ã¾ã—ãŸã€‚

## åˆ©ç”¨ã—ãŸAPI
- https://api-ninjas.com/api/quotes
- https://www.deepl.com/pro-api?cta=header-pro-api

## æ§‹æˆ
- main.go 
- .env

## main.go
### ãƒ©ãƒ³ãƒ€ãƒ ã«ã‚«ãƒ†ã‚´ãƒªã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
```go
func getRandomCategory() string {
	categories := []string{
		"age",
		"alone",
//çœç•¥-----------------------------------
		"movies",
		"success",
	}
	rand.Seed(time.Now().UnixNano())
	return categories[rand.Intn(len(categories))]
}
```
``func getRandomCategory() string `` æˆ»ã‚Šå€¤ã‚’stringæ–¹ã«è¨­å®šã€‚
``	categories := []string `` ã§ã‚«ãƒ†ã‚´ãƒªã‚’é…åˆ—ã§å®šç¾©ã—ã¦ã„ã¾ã™ã€‚
``	rand.Seed(time.Now().UnixNano()) `` ã§ä¹±æ•°ã®ã‚·ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚
``	rand.Intn(len(categories)) `` ã§é…åˆ—ã®é•·ã•ã‚’å–å¾—ã—ã¦ã€ãã®é•·ã•ã®ä¹±æ•°ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™ã€‚
### ãƒ©ãƒ³ãƒ€ãƒ ã«åè¨€ã‚’å–å¾—ã™ã‚‹é–¢æ•°
```go
func getQuote(category string) (*Quote, error) {
	apiURL := fmt.Sprintf("https://api.api-ninjas.com/v1/quotes?category=%s", category)
	req, err := http.NewRequest("GET", apiURL, nil)
	if err != nil {
		return nil, err
	}

	req.Header.Set("X-Api-Key", loadEnv("API_NINJA_KEY"))
	client := http.DefaultClient
	res, err := client.Do(req)
	if err != nil {
		return nil, err
	}
	defer res.Body.Close()

	if res.StatusCode != http.StatusOK {
		return nil, fmt.Errorf("API request returned status %d %s", res.StatusCode, res.Status)
	}

	bodyBytes, err := ioutil.ReadAll(res.Body)
	if err != nil {
		return nil, err
	}

	var quotes []Quote
	err = json.Unmarshal(bodyBytes, &quotes)
	if err != nil {
		return nil, err
	}

	if len(quotes) == 0 {
		return nil, fmt.Errorf("no quotes found for category %s", category)
	}

	return &quotes[0], nil
}
```
``func getQuote(category string) (*Quote, error) `` å¼•æ•°ã‚’category stringå‹ã€æˆ»ã‚Šå€¤ã‚’*Quote, errorå‹ã«è¨­å®šã€‚
``	apiURL := fmt.Sprintf("https://api.api-ninjas.com/v1/quotes?category=%s", category) `` ã§APIã®URLã‚’è¨­å®šã€‚
``	req, err := http.NewRequest("GET", apiURL, nil) `` ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã€‚
``	req.Header.Set("X-Api-Key", loadEnv("API_NINJA_KEY")) `` ã§ãƒ˜ãƒƒãƒ€ãƒ¼ã«APIã‚­ãƒ¼ã‚’è¨­å®šã€‚
``	client := http.DefaultClient `` ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆã€‚
``	res, err := client.Do(req) `` ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã€‚
``	if res.StatusCode != http.StatusOK { `` ã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ãŒ200ä»¥å¤–ã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™ã€‚
``	bodyBytes, err := ioutil.ReadAll(res.Body) `` ã§å—ã‘å–ã£ãŸåè¨€ã‚’èª­ã¿è¾¼ã‚€ã€‚
``	var quotes []Quote `` ã§Quoteå‹ã®é…åˆ—ã‚’å®šç¾©ã€‚
``	err = json.Unmarshal(bodyBytes, &quotes) `` ã§JSONã‚’ãƒ‘ãƒ¼ã‚¹(æ•´åˆ—)ã€‚
``	if len(quotes) == 0 { `` ã§é…åˆ—ã®é•·ã•ãŒ0ã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™ã€‚
``	return &quotes[0], nil `` ã§é…åˆ—ã®0ç•ªç›®ã‚’è¿”ã™ã€‚
### DeepLã«æµã—ã¦ç¿»è¨³ã™ã‚‹é–¢æ•°
```go
func translateText(text, sourceLang, targetLang string) (string, error) {
	// ç¿»è¨³APIã®URLã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
	apiURL := "https://api-free.deepl.com/v2/translate"
	params := url.Values{}
	params.Set("auth_key", loadEnv("DEEPL_API_KEY"))
	params.Set("source_lang", sourceLang)
	params.Set("target_lang", targetLang)
	params.Set("text", text)

	// ç¿»è¨³APIã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
	res, err := http.Get(apiURL + "?" + params.Encode())
	if err != nil {
		return "", fmt.Errorf("failed to send translation request: %v", err)
	}
	defer res.Body.Close()

	// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®JSONã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦ç¿»è¨³çµæœã‚’å–å¾—
	var result struct {
		Translations []struct {
			Text string `json:"text"`
		} `json:"translations"`
	}
	if err := json.NewDecoder(res.Body).Decode(&result); err != nil {
		return "", fmt.Errorf("failed to parse translation response: %v", err)
	}
	if len(result.Translations) == 0 {
		return "", fmt.Errorf("no translations found")
	}
	return result.Translations[0].Text, nil
}
```
- ``func translateText(text, sourceLang, targetLang string) (string, error) `` å¼•æ•°ã‚’text(å¼•ç”¨æ–‡ã‚„è‘—è€…), sourceLang(å…ƒã®è¨€èª), targetLang(ç¿»è¨³å…ˆã®è¨€èª) stringå‹ã€æˆ»ã‚Šå€¤ã‚’string, errorå‹ã«è¨­å®šã€‚
- ``	apiURL := "https://api-free.deepl.com/v2/translate" `` ã§APIã®URLã‚’è¨­å®šã€‚
- ``	params := url.Values{} `` ã§ä»¥é™ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒè¨­å®šã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚
- ``	params.Set("auth_key", loadEnv("DEEPL_API_KEY")) `` ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«APIã‚­ãƒ¼ã‚’è¨­å®šã€‚
- ``	params.Set("source_lang", sourceLang) `` ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«å…ƒã®è¨€èªã‚’è¨­å®šã€‚
- ``	params.Set("target_lang", targetLang) `` ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ç¿»è¨³å…ˆã®è¨€èªã‚’è¨­å®šã€‚
- ``	params.Set("text", text) `` ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«å¼•ç”¨æ–‡ã‚„è‘—è€…ã‚’è¨­å®šã€‚
- ``	res, err := http.Get(apiURL + "?" + params.Encode()) `` ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã€‚
- ``	var result struct { `` ã§ç¿»è¨³çµæœã‚’æ ¼ç´ã™ã‚‹æ§‹é€ ä½“ã‚’å®šç¾©ã€‚
- ``	if err := json.NewDecoder(res.Body).Decode(&result); err != nil { `` ã§JSONã‚’ãƒ‘ãƒ¼ã‚¹(æ•´åˆ—)ã€‚
- ``	if len(result.Translations) == 0 { `` ã§ç¿»è¨³çµæœã®é•·ã•ãŒ0ã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™ã€‚
- ``	return result.Translations[0].Text, nil `` ã§ç¿»è¨³çµæœã‚’è¿”ã™ã€‚

### mainé–¢æ•°
```go
func main() {
	category := getRandomCategory()
	quote, err := getQuote(category)
	if err != nil {
		fmt.Println(err)
		return
	}

	// å¼•ç”¨æ–‡ã¨è‘—è€…åã‚’ç¿»è¨³
	translatedQuote, err := translateText(quote.Quote, "en", "ja")
	if err != nil {
		fmt.Printf("Failed to translate quote: %v", err)
		return
	}
	translatedAuthor, err := translateText(quote.Author, "en", "ja")
	if err != nil {
		fmt.Printf("Failed to translate author: %v", err)
		return
	}

	fmt.Printf("%q - %s\n", quote.Quote, quote.Author)
	// ç¿»è¨³çµæœã‚’å‡ºåŠ›
	fmt.Printf("%q - %s\n", translatedQuote, translatedAuthor)
}
```
- ``func main() `` ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã¨ãªã‚‹é–¢æ•°ã€‚
  - ``	category := getRandomCategory() `` ã§ãƒ©ãƒ³ãƒ€ãƒ ãªã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’å–å¾—ã€‚
  - ``	quote, err := getQuote(category) `` ã§å¼•ç”¨æ–‡ã¨è‘—è€…åã‚’å–å¾—ã€‚
  - ``	translatedQuote, err := translateText(quote.Quote, "en", "ja") `` ã§å¼•ç”¨æ–‡ã‚’ç¿»è¨³ã€‚è‹±èªã‹ã‚‰æ—¥æœ¬èªã¸ã¨è¨­å®š
  - ``	translatedAuthor, err := translateText(quote.Author, "en", "ja") `` ã§è‘—è€…åã‚’ç¿»è¨³ã€‚è‹±èªã‹ã‚‰æ—¥æœ¬èªã¸ã¨è¨­å®š
  - ``	fmt.Printf("%q - %s\n", quote.Quote, quote.Author) `` ã§åŸæ–‡ã®å¼•ç”¨æ–‡ã¨è‘—è€…åã‚’å‡ºåŠ›ã€‚
    - ``	fmt.Printf("%q - %s\n", translatedQuote, translatedAuthor) `` ã§ç¿»è¨³ã—ãŸã‚‚ã®ã‚’å‡ºåŠ›ã€‚

## Goè¨€èªã‚’ä½¿ã£ã¦ã¿ãŸæ‰€æ„Ÿ
- C#ã‚ˆã‚Šè‹¥å¹²ã‚³ãƒ¼ãƒ‰ãŒçŸ­ãæ›¸ã‘ã‚‹æ„Ÿã˜ãŒã—ãŸã€‚
- Goè¨€èªã®ã‚³ãƒ¼ãƒ‰ã¯C#ã‚ˆã‚Šã‚‚èª­ã¿ã«ãã„æ°—ãŒã—ãŸã€‚
- Apiã‚’åˆ©ç”¨ã—ãŸã‚„ã‚Šå–ã‚Šã ã‘ãªã®ã§æ­£ç›´ã‚ã¾ã‚Šé•ã„ã¯æ„Ÿã˜ãªã‹ã£ãŸã®ãŒæœ¬éŸ³ã€‚
- æ¬¡å›ã¯ã‚‚ã†å°‘ã—è¦æ¨¡ã®å¤§ããªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’çµ„ã‚“ã§ã‚ˆã‚ŠGoè¨€èªã®è‰¯ã•ã‚’æ„Ÿã˜ã¦ã¿ãŸã„ã€‚

