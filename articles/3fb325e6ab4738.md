---
title: "ã€Goã€‘BunRouterã®ãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ä½œã£ã¦ã¿ãŸ"
emoji: "ğŸ˜Š"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [go, bunrouter,api,backend]
published: true
publication_name: 
---
## å…¬å¼
https://bunrouter.uptrace.dev/guide/golang-router.html

## ãªãœBunRouterã‚’è§¦ã‚ã†ã¨æ€ã£ãŸã®ã‹
å˜ç´”ã«è§¦ã£ãŸã“ã¨ãŒãªã„ã‹ã‚‰ã§ã™ï½—
ã“ã‚Œã¾ã§Goã®APIé–‹ç™ºã§ã¯echoã‚„ginã‚’ä½¿ã£ã¦ã„ã¾ã—ãŸã€‚ä½•ã‹åˆ¥ã®ã‚‚é‡ã§è‰¯ã•ãã†ãªã®ãŒãªã„ã‹ãªãƒ¼ã¨æ¢ã—ã¦ã„ãŸæ™‚ã«
Xã§Bunã¨å‘¼ã°ã‚Œã‚‹ORMãŒã‚ˆã•ãã†ã ã¨ã„ã†è©±ã‚’å°è€³ã«ã¯ã•ã¿èª¿ã¹ã¦ã¿ã¾ã—ãŸã€‚
å…¬å¼ãƒšãƒ¼ã‚¸ã«è¡Œãã¨ORMã®ã»ã‹ã«Golang HTTP routerã‚‚ä½œã£ã¦ã„ã‚‹ã¨è¡¨ç¤ºãŒå‡ºã¦ãã¾ã—ãŸã€‚
ãã“ã§ã„ã‚ã„ã‚ã¨èª¿ã¹ã¦ã¿ã‚‹ã†ã¡ã«BunRouterã‚’é­…ã›ã¦ãã‚‹è¡¨ã‚’è¦‹ã¤ã‘ã¦ã—ã¾ã„ã¾ã—ãŸã€‚
![img.png](/images/3fb325e6ab4738/img.png)
**net/httpã¨ã®äº’æ›æ€§ãŒã‚ã‚Šã€å·¨å¤§ãªãƒ©ãƒƒãƒ‘ãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ãªãæœ€å°é™ã®APIã‚’ä½¿ç”¨ã§ãã‚‹ã¨ã“ã‚ãŒã‚ã¡ã‚ƒãã¡ã‚ƒãˆãˆã‚„ã‚“ã¦ãªã‚Šã¾ã—ãŸã€‚**

ãã‚Œã§ã¯å®Ÿè¡Œãƒã‚¤ãƒ³ãƒˆã¨ãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†

## ã‚³ãƒ¼ãƒ‰
main.go
```go
func main() {
	//ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç”Ÿæˆã—DIã™ã‚‹
	db, _ := config.NewDBConnection()
	userRepository := infrastructure.NewUserRepository(db)
	userService := service.NewUserService(userRepository)
	userHandler := _interface.NewUserHandler(userService)
	middleware := middleware.NewMiddleware(userService)
    // ã“ã“ã‹ã‚‰ä¸‹ã ã‘è¦‹ã‚Œã°OK
	//bunrouterèµ·å‹•
    r := bunrouter.New()
	//middlewearå®šç¾©
	r.Use(middleware.RecoverMiddleware())
	r.Use(middleware.CorsMiddleware())
	//ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®šç¾©
	r.POST("/user/create", userHandler.UserCreateHandle())
	r.POST("/user/get", userHandler.UserGetHandle())
	r.POST("/move", userHandler.MoveHandle())
	r.POST("/destroy", userHandler.DestroyHandle())
	r.GET("/users/get", userHandler.UserRankingGetHandle())
    // ã‚µãƒ¼ãƒãƒ¼ã‚’ãƒªãƒƒã‚¹ãƒ³ã™ã‚‹
	log.Println("listening on http://localhost:8080")
	log.Println(http.ListenAndServe(":8080", r))
}
```
handler.go
```go
type UserHandler struct {
	userService service.UserService
}

func NewUserHandler(userService *service.UserService) *UserHandler {
	return &UserHandler{userService: *userService}
}

func (u *UserHandler) UserCreateHandle() bunrouter.HandlerFunc {
	return func(w http.ResponseWriter, req bunrouter.Request) error {
		//ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§æ¥ã‚‹æ§‹é€ ä½“ã‚’å®šç¾©
		var requestData request.UserCreateRequest
		//æ§‹é€ ä½“ã«åˆã‚ã›ã¦ãƒ‡ã‚³ãƒ¼ãƒ‰
		if err := json.NewDecoder(req.Body).Decode(&requestData); err != nil {
			http.Error(w, "Failed to parse request", http.StatusBadRequest)
			return err
		}
        //ã‚³ãƒ³ãƒ†ã‚¯ã‚¹ãƒˆã‚’å–å¾—
		ctx := req.Context()
		//serviceå±¤ã‹ã‚‰èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
		authToken, err := u.userService.Add(ctx, requestData.Name)
		if err != nil {
			http.Error(w, "Failed to create user", http.StatusInternalServerError)
			return err
		}
		//ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«è¿”ã™jsonæ§‹é€ ä½“ã‚’å®šç¾©
		responseData := &response.UserCreateResponse{Token: authToken}
		//å…ˆã»ã©ã®æ§‹é€ ä½“ã‚’jsonã«ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹
		responseBytes, err := json.Marshal(responseData)
		if err != nil {
			http.Error(w, "Failed to generate response", http.StatusInternalServerError)
			return err
		}
        //ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«è¿”ã™éš›ã®å±æ€§ã‚’ä»˜ã‘ã‚‹
		w.Header().Set("Content-Type", "application/json")
		w.WriteHeader(http.StatusOK)
		w.Write(responseBytes)
		return nil
	}
}
```
## æ‰€æ„Ÿ
- ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹éƒ¨åˆ†ã¯ã»ã¼"net/http"ã§ã‚„ã‚‹ã‚‚ã®ã¨ã»ã¼å¤‰ã‚ã‚‰ãªã„æ„Ÿã˜ã§ã—ãŸã€‚
- ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®å®šç¾©ãŒæ¥½ã«ãªã£ã¦ã¦ã„ã„ãªã¨ã„ã†æ„Ÿã˜ã ã£ãŸã€‚

## ã¾ã¨ã‚
echoã‚„ginãªã©ã§ä½¿ã‚ã‚Œã‚‹å¿…è¦æœ€ä½é™ã®éƒ¨åˆ†ãŒåˆ©ç”¨ã§ãã‚‹ã¨ã„ã†æ„Ÿã˜ã§éå¸¸ã«ãƒŸãƒ‹ãƒãƒ ãªã‚‚ã®ã«ãªã£ã¦ã„ãŸæ„Ÿã˜ã§ã‚ã‚Šã¾ã—ãŸï½
